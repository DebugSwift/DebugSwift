desc "Run the tests and prepare for Danger"
lane :test do
  # 1) Resolve the Swift‚ÄêPM manifest in your package root
  #    (so that DebugSwift itself is fetched)
  sh "swift package resolve --package-path \"..\"", log: true

  # 2) Tell Xcode to resolve any SPM dependencies you've just added
  sh "xcodebuild -resolvePackageDependencies -project Example.xcodeproj -scheme Example", log: true

  # 3) Build & test with Fastlane's scan
  scan(
    project:            "Example.xcodeproj",
    scheme:             "Example",
    derived_data_path:  "temp/derived",
    clean:              true,
    result_bundle:      true,
    code_coverage:      true,
    devices:            ['iPhone 16'],
    skip_package_dependencies_resolution: false
  )
end
